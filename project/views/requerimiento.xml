<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- ==================== Listado / Tree ====================  -->
    <record id="project_requerimiento_tree" model="ir.ui.view">
        <field name="name">project.requerimiento.tree</field>
        <field name="model">project.requerimiento</field>
        <field name="arch" type="xml">
            <tree 
                decoration-info="state=='borrador'" 
                decoration-primary="state=='radicado'" 
                decoration-success="state=='aprobado'"
                decoration-danger="state=='devuelto'">           
                <field name="name"/>
                <field name="titulo"/>
                <field name="create_date" string="Fecha Inicial"/>
                <field name="project_id"/>
                <field name="ciclo_vida_id"/>
                <field name="state"/>
                <field name="create_uid" string="Creado por"/>
            </tree>
        </field>
    </record>

    <!-- ==================== Listado / Kanban ====================  -->
    <record model="ir.ui.view" id="project_requerimiento_kanban">
        <field name="name">project.requerimiento.kanban</field>
        <field name="model">project.requerimiento</field>
        <field name="arch" type="xml">
            <kanban class="oe_background_grey o_kanban_dashboard o_project_kanban o_emphasize_colors">
                <field name="name"/>
                <field name="titulo"/>
                <field name="project_id"/>
                <field name="ciclo_vida_id"/>
                <field name="director_id"/>
                <field name="lider_id"/>
                <field name="gestor_id"/>
                <field name="color"/>
                <field name="create_uid"/>
                <templates>
                <t t-name="kanban-box">
                    <div t-attf-class="#{kanban_color(record.color.raw_value)} oe_kanban_global_click o_has_icon">
                    <!-- <div t-attf-class="oe_kanban_global_click o_has_icon"> -->
                        <div class="o_project_kanban_main">
                            <div class="o_kanban_card_content">
                                <div class="o_kanban_record_top" style="font-size: 15px;"> 
                                    <div class="o_kanban_record_headings">
                                        <strong>[<field name="name"/>]: </strong><span><field name="titulo"/></span>
                                        <div style="height: 5px;"></div>            
                                        <b>Proyecto: </b> <span><field name="project_id"/></span>
                                        <div style="height: 5px;"></div>            
                                        <b>Ciclo de Vida: </b> <span><field name="ciclo_vida_id"/></span>                                        
                                    </div>
                                </div>
                                <div class="" style="color: #7C7BAD;margin-top: 10px;font-size: 12px;">
                                    <table>
                                        <tbody>
                                            <tr>
                                                <td><b>Director: </b></td>
                                                <td><field name="director_id"/></td>
                                            </tr>
                                            <tr>
                                                <td><b>Líder: </b></td>
                                                <td><field name="lider_id"/></td>
                                            </tr>
                                            <tr>
                                                <td><b>Gestor: </b></td>
                                                <td><field name="gestor_id"/></td>
                                            </tr>                                        
                                        </tbody>
                                    </table>                                                                
                                </div>
                            </div>
                            <div class="o_kanban_card_manage_pane dropdown-menu" role="menu">
                                <div class="o_kanban_card_manage_section o_kanban_manage_reports">
                                    <div role="menuitem">
                                        <a type="edit">Edit</a>
                                    </div>
                                </div>
                            </div>                            
                        </div>
                        <div class="o_project_kanban_boxes">
                            <table style="margin: 10px 0px 0px;">
                                <tbody>
                                    <tr>
                                        <td style="padding-right: 5px;"><span>Creado por:</span></td>
                                        <td><b><field name="create_uid"/></b></td>
                                    </tr>
                                </tbody>
                            </table>                                                
                        </div>                          
                    </div>
                </t>
                </templates>
            </kanban>
        </field>
    </record>    

   
    <!-- ==================== Formulario (Radicado) ==================== -->
    <record id="project_requerimiento_radicado" model="ir.ui.view">
        <field name="name">project.requerimiento.form</field>
        <field name="model">project.requerimiento</field>
        <field name="arch" type="xml">
            <form string="Requerimientos">
                <header>
                    <!--            
                    <button name="btn_send_email" string="Enviar correo" 
                        class="oe_highlight oe_edit_only"
                        type="action"
                        groups="project.group_project_manager,project.group_project_gestor"
                    />
                    -->

                    <button id="button_confirmar" name="action_radicar" string="Radicar" class="btn-primary" states="borrador"
                        confirm="¿Estás seguro(a) que desea radicar el requerimiento?" 
                        type="object"
                        groups="project.group_project_manager,project.group_project_gestor,project.group_project_user"
                    />

                    <!--
                    <button id="button_hecho" name="action_aprobar" string="Aprobar" class="btn-primary" states="radicado"
                        confirm="¿Estás seguro(a) que desea aprobar el requerimiento?"
                        type="object"
                        groups="project.group_project_manager,project.group_project_gestor"
                    />
                    -->

                    <button id="button_borrador" name="action_borrador" string="Establecer a borrador" class="btn-primary" states="devuelto"
                        type="object"
                        groups="project.group_project_manager,project.group_project_gestor"
                    />

                    <button id="button_cancelar" name="action_devolver" string="Devolver" class="btn-primary" states="radicado"
                        confirm="¿Estás seguro(a) que desea devolver el requerimiento?"
                        type="object"
                        groups="project.group_project_manager,project.group_project_gestor"
                    />                                                                

                    <field name="state" widget="statusbar" statusbar_visible="nuevo,radicado,devuelto,aprobado"/>
                </header>
                <sheet>                    
                    <div class="oe_button_box">
                        <button class="oe_stat_button" name="attachment_tree_view" type="object" 
                            icon="fa-files-o">
                            <field string="Documentos" name="doc_count" widget="statinfo"/>
                        </button>
                    </div>                   
                    <div class="oe_title">    
                        <h1>
                            <!-- <span>Código</span>: --> 
                            <field name="name" readonly="1" attrs="{'invisible': [('state','in',('nuevo','borrador','radicado'))]}" groups="project.group_project_manager,project.group_project_user"/>
                        </h1>                        
                    </div>                
                    <div class="oe_title pr-0">
                        <h1 class="d-flex flex-row justify-content-between">
                            <field name="titulo" class="o_task_name text-truncate" placeholder="Título del Requerimiento..." default_focus="1" />
                        </h1>
                    </div>
                    
                    <div attrs="{'invisible': [('state','in',('nuevo','borrador'))]}">
                        <group>
                            <!-- =========== Asignación de Código: Administrador y Gestor =========== -->
                            <field name="project_id" groups="project.group_project_manager,project.group_project_gestor"/>
                            <field name="ciclo_vida_id" groups="project.group_project_manager,project.group_project_gestor"/>
                            <field name="fecha_radicacion" attrs="{'invisible': [('state', '=', 'borrador')]}"/> 
                            <field name="fecha_aprobacion" attrs="{'invisible': [('state','in',('borrador','radicado'))]}"/>
                        </group>
                        <br/>
                        <h2 groups="project.group_project_manager,project.group_project_gestor">Interesados:</h2>
                        <group>
                            <!-- =========== Asignación de responsables: Administrador y Gestor =========== -->
                            <field name="director_id" groups="project.group_project_manager,project.group_project_gestor"/>
                            <field name="lider_id" groups="project.group_project_manager,project.group_project_gestor"/>
                            <field name="gestor_id" groups="project.group_project_manager,project.group_project_gestor"/>
                        </group>                         
                    </div>
                    
                    <notebook>
                        <page string="Descripción">
                            <field name="descripcion" type="html"/>
                            <div class="oe_clear"/>
                        </page>
                        <page string="Servicios" groups="project.group_project_manager,project.group_project_gestor">
                            <group>
                                <field name="servicio_ids"/>
                            </group>
                        </page>
                    </notebook>               
                </sheet>
                <div class="oe_chatter">
                    <field name="message_follower_ids" widget="mail_followers"/>
                    <field name="activity_ids" widget="mail_activity" groups="project.group_project_manager,project.group_project_director,project.group_project_lider,project.group_project_gestor"/>
                    <field name="message_ids" widget="mail_thread" options="{'post_refresh': 'recipients'}"/>
                </div>                
            </form>
        </field>
    </record>      

</odoo>
